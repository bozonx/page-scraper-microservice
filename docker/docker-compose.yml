services:
  microservice:
    image: ghcr.io/bozonx/page-scraper-microservice:latest
    container_name: page-scraper-microservice
    hostname: page-scraper-microservice
    restart: unless-stopped
    stop_grace_period: 30s
    ports:
      - '8080:8080'
    environment:
      - TZ=UTC
      - LOG_LEVEL=warn
      - MAX_CONCURRENCY=3
      - DEFAULT_MODE=extractor
      - DEFAULT_TASK_TIMEOUT_SECS=60
      - DEFAULT_FINGERPRINT_USER_AGENT=auto
      - DEFAULT_FINGERPRINT_LOCALE=en-US
      - DEFAULT_FINGERPRINT_TIMEZONE_ID=UTC
      - DEFAULT_FINGERPRINT_GENERATE=true
      - DEFAULT_FINGERPRINT_ROTATE_ON_ANTI_BOT=true
      - PLAYWRIGHT_HEADLESS=true
      - PLAYWRIGHT_NAVIGATION_TIMEOUT_SECS=30
      - DEFAULT_PLAYWRIGHT_BLOCK_TRACKERS=true
      - DEFAULT_PLAYWRIGHT_BLOCK_HEAVY_RESOURCES=true
      - DATA_LIFETIME_MINS=60
      - CLEANUP_INTERVAL_MINS=10
    healthcheck:
      test: ['CMD-SHELL', 'wget -qO- http://127.0.0.1:8080/api/v1/health || exit 1']
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
